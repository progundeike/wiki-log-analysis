# コマンドラインで動作する Wikipedia のログ解析システム

## はじめに

コマンドライン上で動作するwikipediaのログ解析システムを作成しました。
こちらはプログラミング学習サービス、独学エンジニアの課題への取り組みです。

https://dokugaku-engineer.com/

データベースのパートの最後の課題として出題されるもので、模範解答はありません。

## 実装する機能

  公開されているWikipediaのアクセスログを用いて、

  タスク1:　指定した記事数の閲覧数の多い順に、「ドメインコード」、「ページタイトル」、「閲覧数」を表示する

  タスク2:　指定したドメインコードを人気順にソートし、ドメインコードと合計閲覧数を表示する

## 解析に使用するデータ

wikipediaで公開されている、アクセスログを集計したファイルをダウンロードして使用します。
データは2021年12月1日のものを使用しました。下記URLからダウンロードできます。
https://dumps.wikimedia.org/other/pageviews/2021/2021-12/

### データの概要

データはページごとの閲覧数を1時間ごとに集計したものがgzipで圧縮されています。
データはスペースで区切られ、以下の4つカラムからなる行で構成されています。

1. ドメインコード
    リクエストのドメイン名を省略した形式で表記

2. ページタイトル
    リクエストされたURLの/wiki/の後の非正規化された部分のタイトルを保持

3. 閲覧回数
    集計時間内にこのページが閲覧された回数

4. 総レスポンスサイズ
    集計時間内にこのページへのリクエストによって引き起こされたレスポンスサイズの合計。今回は参照しません。

サンプル(先頭5行)

```text
aa Main_Page 4 0
aa Wikipedia 1 0
aa Wikipedia:Statistics 1 0
aa.b Main_Page 1 0
aa.d Main_Page 4 0
```

今回使用したファイルでは、このようなデータが約510万行入っています。
公開されているデータについての全体の解説、テーブル定義の詳細は下記URLをご参照ください。
https://dumps.wikimedia.org/other/pageviews/readme.html
https://wikitech.wikimedia.org/wiki/Analytics/Data_Lake/Traffic/Pageviews

## 使用方法

あらかじめ解析に使用するファイルをダウンロード、展開し、app/log_fileディレクトリにpage_viewsという名前で保存してください。

Dockerコンテナの生成、起動

```text
$ docker compose up -d --build
```

解析プログラムの実行

```text
$ docker compose exec app php wiki_log_analyze.php
```

プログラムが起動した後は、ガイダンスに従って入力していきます。
初めに

```text
DBをインポートしますか？ 'y' or 'n'
```

というメッセージが表示されますので、初回や、ファイルを変更した場合は'y'を入力し、インポート済みの場合は'n'を入力してください。
'y'を選択した場合、データのインポートに少し時間がかかります。

```text
ログファイルをデータベースにインポート中です。
インポートが完了しました。
解析するタスクナンバーを入力してください。終了するには0を入力してください。(半角数字)
タスク1: 記事数を指定して、閲覧数の多い順に表示します
タスク2: ドメインコードを入力し、閲覧数の多い順に合計閲覧数を表示します
```

インポートが完了すると、メッセージに従い使用するタスクの番号を半角数字で入力してください。

タスク1を選択すると、


タスク2を選択すると、


解析を終了するには'0'を入力してください。
